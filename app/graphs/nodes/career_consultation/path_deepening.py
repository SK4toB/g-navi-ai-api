# app/graphs/nodes/career_consultation/path_deepening.py
"""
ì„ íƒí•œ ê²½ë¡œì— ëŒ€í•œ ì‹¬í™” ë…¼ì˜ ë…¸ë“œ
ì‚¬ìš©ìì˜ ëª©í‘œì™€ ì´ìœ ë¥¼ ë¶„ì„í•˜ì—¬ ì‚¬ë‚´ ë°ì´í„° ê¸°ë°˜ ì•¡ì…˜ í”Œëœ ìˆ˜ë¦½
AI ê¸°ë°˜ ê°œì¸ ë§ì¶¤í˜• ì „ëµ ë¶„ì„ í¬í•¨
"""

import os
from typing import Dict, Any
from app.graphs.state import ChatState
from app.utils.html_logger import save_career_response_to_html


class PathDeepeningNode:
    """
    ê²½ë¡œ ì‹¬í™” ë…¼ì˜ ë…¸ë“œ
    """
    
    def __init__(self, graph_builder):
        self.graph_builder = graph_builder
        # Agentë¥¼ ì§ì ‘ ì‚¬ìš©
        from app.graphs.agents.retriever import CareerEnsembleRetrieverAgent, NewsRetrieverAgent
        self.retriever_agent = CareerEnsembleRetrieverAgent()
        self.news_agent = NewsRetrieverAgent()  # ë‰´ìŠ¤ ê²€ìƒ‰ ì „ìš© ì—ì´ì „íŠ¸ ì¶”ê°€
    
    async def _generate_ai_action_plan(self, merged_user_data: dict, selected_path: dict, user_goals: str, retrieved_data: dict, path_selection_context: dict = None) -> str:
        """AI ê¸°ë°˜ ì‚¬ë‚´ ë°ì´í„°ë¥¼ í™œìš©í•œ ì•¡ì…˜ í”Œëœ ë° ë©˜í†  ì¶”ì²œ ìƒì„±"""
        try:
            from openai import AsyncOpenAI
            
            api_key = os.getenv("OPENAI_API_KEY")
            if not api_key:
                return "AI ë¶„ì„ ê¸°ëŠ¥ì´ í˜„ì¬ ì´ìš© ë¶ˆê°€í•©ë‹ˆë‹¤."
            
            client = AsyncOpenAI(api_key=api_key)
            
            # íšŒì‚¬ ë¹„ì „ ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
            company_vision_context = ""
            try:
                company_vision_context = self.retriever_agent.get_company_vision_context()
                print(f" DEBUG - path_deepeningì—ì„œ íšŒì‚¬ ë¹„ì „ ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° ì„±ê³µ: {len(company_vision_context)}ì")
            except Exception as e:
                print(f"- WARNING - path_deepeningì—ì„œ íšŒì‚¬ ë¹„ì „ ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: {e}")
                company_vision_context = ""
            
            path_name = selected_path.get('name', 'ì„ íƒëœ ê²½ë¡œ')
            
            # ë””ë²„ê¹…: AI ë©”ì„œë“œì— ì „ë‹¬ëœ ë°ì´í„° í™•ì¸
            print(f" DEBUG - path_deepening AI ë©”ì„œë“œì— ì „ë‹¬ëœ merged_user_data: {merged_user_data}")
            print(f" DEBUG - ìƒë‹´ ëŒ€ìƒì ì •ë³´: ì´ë¦„={merged_user_data.get('name', 'None')}, ê²½ë ¥={merged_user_data.get('experience', 'None')}, ìŠ¤í‚¬={merged_user_data.get('skills', 'None')}, ë„ë©”ì¸={merged_user_data.get('domain', 'None')}")
            print(f" DEBUG - path_deepening user_goals: {user_goals}")
            print(f" DEBUG - path_selection_context: {path_selection_context}")
            
            # retrieved_dataì—ì„œ ì‚¬ë‚´ ê²½ë ¥ ë°ì´í„°ì™€ ë‰´ìŠ¤ ë°ì´í„° ì¶”ì¶œ
            career_data = retrieved_data.get('career_data', [])
            news_data = retrieved_data.get('news_data', [])
            
            print(f" DEBUG - career_data: {len(career_data)}ê°œ, news_data: {len(news_data)}ê°œ")
            
            career_context = ""
            news_context = ""
            
            # ì‚¬ë‚´ ê²½ë ¥ ë°ì´í„° ì²˜ë¦¬ (ê°„ê²°í•˜ê²Œ ê°œì„ )
            if career_data:
                print(f" SUCCESS - {len(career_data)}ê°œì˜ ì‚¬ë‚´ êµ¬ì„±ì› ë°ì´í„° í™œìš© ê°€ëŠ¥")
                career_context = f"""
**ì‚¬ë‚´ êµ¬ì„±ì› ì„±ê³µ ì‚¬ë¡€ ({len(career_data)}ëª… ë¶„ì„):**
- ì´ {len(career_data)}ëª…ì˜ ìœ ì‚¬ ê²½ë ¥ êµ¬ì„±ì› ë°ì´í„° ë¶„ì„ ì™„ë£Œ
- ê²½ë ¥ ì „í™˜ ë° ì„±ì¥ íŒ¨í„´ íŒŒì•… ê°€ëŠ¥
- ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ìµëª…í™” ì²˜ë¦¬ë¨
- ì‹¤ì œ ì‚¬ë‚´ ì„±ê³µ ì‚¬ë¡€ ê¸°ë°˜ ë¶„ì„ ê²°ê³¼ ì œê³µ
"""
                print(f" DEBUG - ìƒì„±ëœ career_context ê¸¸ì´: {len(career_context)}")
            else:
                career_context = "**ì‚¬ë‚´ êµ¬ì„±ì› ë°ì´í„°:** í˜„ì¬ ë¶„ì„ ê°€ëŠ¥í•œ ë°ì´í„° ì—†ìŒ"
                print("- WARNING - career_dataê°€ ë¹„ì–´ìˆì–´ ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©")
            
            # ìµœì‹  ë‰´ìŠ¤ ë°ì´í„° ì²˜ë¦¬ (ê°„ê²°í•˜ê²Œ ê°œì„ )
            if news_data:
                print(f" SUCCESS - {len(news_data)}ê°œì˜ ìµœì‹  ë‰´ìŠ¤ ë°ì´í„° í™œìš© ê°€ëŠ¥")
                news_context = f"""
**ìµœì‹  ì—…ê³„ ë™í–¥ ë° ê¸°ìˆ  íŠ¸ë Œë“œ ({len(news_data)}ê°œ ë‰´ìŠ¤ ë¶„ì„):**
- ì´ {len(news_data)}ê°œì˜ ìµœì‹  ë‰´ìŠ¤ ë°ì´í„° ë¶„ì„ ì™„ë£Œ
- ì—…ê³„ ìµœì‹  ë™í–¥ ë° ê¸°ìˆ  ë°œì „ ë°©í–¥ íŒŒì•… ê°€ëŠ¥
- ì»¤ë¦¬ì–´ ì„±ì¥ê³¼ ì—°ê³„ëœ ì‹œì¥ íŠ¸ë Œë“œ ì •ë³´ ì œê³µ
- ì„ íƒí•œ ì»¤ë¦¬ì–´ ê²½ë¡œì™€ ê´€ë ¨ëœ ìµœì‹  ì—…ê³„ ë³€í™” ë°˜ì˜
- ì‹¤ì œ ë‰´ìŠ¤ ë°ì´í„° ê¸°ë°˜ ë¶„ì„ ê²°ê³¼ ì œê³µ
"""
                print(f" DEBUG - news_context ìƒì„± ì™„ë£Œ: {len(news_context)}ì")
            else:
                news_context = "**ìµœì‹  ë‰´ìŠ¤ ë°ì´í„°:** í˜„ì¬ ë¶„ì„ ê°€ëŠ¥í•œ ë°ì´í„° ì—†ìŒ"
                print("- WARNING - news_dataê°€ ë¹„ì–´ìˆì–´ ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©")
            
            # path_selection_context ì •ë³´ë¥¼ í”„ë¡¬í”„íŠ¸ì— ì¶”ê°€ (AIê°€ ì»¨í…ìŠ¤íŠ¸ íŒë‹¨)
            selection_context_str = ""
            if path_selection_context:
                combined_context = path_selection_context.get('combined_user_context', '')
                path_name = path_selection_context.get('selected_path_name', 'ì •ë³´ ì—†ìŒ')
                
                # ì‚¬ìš©ìì˜ ì „ì²´ ì»¨í…ìŠ¤íŠ¸ê°€ ìˆëŠ” ê²½ìš° AIê°€ ë¶„ì„í•˜ë„ë¡ í”„ë¡¬í”„íŠ¸ êµ¬ì„±
                if combined_context.strip():
                    selection_context_str = f"""
** {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì˜ ê²½ë¡œ ì„ íƒ ë° ìƒì„¸ ì»¨í…ìŠ¤íŠ¸:**

**ì„ íƒí•œ ê²½ë¡œ:** {path_name}

**ì‚¬ìš©ì ë‹µë³€ ì „ì²´ ì»¨í…ìŠ¤íŠ¸:**
"{combined_context}"

** AI ë¶„ì„ ìš”ì²­:**
ìœ„ì˜ ì‚¬ìš©ì ë‹µë³€ì„ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ë‹¤ìŒ ìš”ì†Œë“¤ì„ íŒŒì•…í•´ì£¼ì„¸ìš”:
1. **ê²½ë¡œ ì„ íƒ ì´ìœ **: ì™œ ì´ ê²½ë¡œë¥¼ ì„ íƒí–ˆëŠ”ì§€
2. **í˜„ì¬ ìƒí™©ê³¼ ê³ ë¯¼**: ì–´ë–¤ ìƒí™©ì—ì„œ ì–´ë–¤ ê³ ë¯¼ì„ í•˜ê³  ìˆëŠ”ì§€
3. **êµ¬ì²´ì  ëª©í‘œ**: ë¬´ì—‡ì„ ë‹¬ì„±í•˜ê³  ì‹¶ì–´í•˜ëŠ”ì§€
4. **ê°œì¸ì  ë™ê¸°**: ê°œì¸ì ì¸ ì„±ì¥ ë™ê¸°ì™€ ê¸°ëŒ€ì‚¬í•­
5. **ì œì•½ ì¡°ê±´**: í˜„ì¬ ìƒí™©ì—ì„œì˜ ì œì•½ì´ë‚˜ ìš°ë ¤ì‚¬í•­

** ê°œì¸í™” ì „ëµ:**
ì´ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ **{merged_user_data.get('name', 'ê³ ê°')}ë‹˜**ë§Œì„ ìœ„í•œ êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ë§ì¶¤í˜• ì¡°ì–¸ì„ ì œê³µí•´ì£¼ì„¸ìš”."""
                else:
                    # ê¸°ë³¸ ì»¨í…ìŠ¤íŠ¸ë§Œ ìˆëŠ” ê²½ìš°
                    selection_context_str = f"""
**ê²½ë¡œ ì„ íƒ ì»¨í…ìŠ¤íŠ¸:**
- **ì„ íƒí•œ ê²½ë¡œ**: {path_name}
- **ì¼ë°˜ì ì¸ ê´€ì‹¬ ë¶„ì•¼**: {path_name} ê´€ë ¨ ì„±ì¥ í¬ë§"""
            
            # ë©˜í†  ì¶”ì²œ í”„ë¡¬í”„íŠ¸ ê°œì„ 
            # --- ë°ì´í„° ê¸°ë°˜ ì„±ì¥ ì‚¬ë¡€ ë¶„ì„ ì„¹ì…˜ ì‘ì„± ì§€ì¹¨ ì¶”ê°€ ---
            data_case_guideline = '''
**[ë°ì´í„° ê¸°ë°˜ ì„±ì¥ ì‚¬ë¡€ ë¶„ì„ ì„¹ì…˜ ì‘ì„± ì§€ì¹¨(ë¬´ì¡°ê±´ ì¤€ìˆ˜):]**
- ë°˜ë“œì‹œ ì‹¤ì œ ì‚¬ë‚´ êµ¬ì„±ì› ë°ì´í„°(ê²½ë ¥, ìŠ¤í‚¬, ì„±ì¥ ê³¼ì • ë“±), ë‰´ìŠ¤ë§Œì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
- "{name}ë‹˜ê³¼ ìœ ì‚¬í•œ ë°°ê²½ì—ì„œ ì‹œì‘"ì´ë¼ëŠ” ì ì„ ê°•ì¡°í•˜ì„¸ìš”.
- ì‹¤ì œ ë°ì´í„°ì— ì—†ëŠ” ì •ë³´(ì˜ˆ: ì´ì§, ì™¸ë¶€ ëŒ€ê¸°ì—… ê²½ë ¥, ì™¸ë¶€ AIíŒ€ ê·¼ë¬´ ë“±)ëŠ” ì ˆëŒ€ ì–¸ê¸‰í•˜ì§€ ë§ˆì„¸ìš”.
- ì„±ì¥ ìŠ¤í† ë¦¬, ì„±ê³µ íŒ¨í„´ ë“±ë„ ì‹¤ì œ ì‚¬ë‚´ ë°ì´í„°(ê²½ë ¥, ìŠ¤í‚¬, í”„ë¡œì íŠ¸, ì‚¬ë‚´ í™œë™ ë“±)ë§Œì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
- ì—†ëŠ” ì •ë³´, ì¶”ì •/ê°€ê³µëœ ì™¸ë¶€ ê²½ë ¥, í—ˆêµ¬ì˜ ì´ì§/ì™¸ë¶€ í™œë™ ë“±ì€ ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
- ì„±ê³µ ì‚¬ë¡€ëŠ” ì‹¤ì œ ë°ì´í„°ê°€ ìˆëŠ” ë§Œí¼ë§Œ ì‘ì„±í•˜ì„¸ìš”. (ì˜ˆ: 1ëª…ë§Œ ìˆìœ¼ë©´ 1ëª…, 2ëª…ì´ë©´ 2ëª…, ìµœëŒ€ 3ëª…ê¹Œì§€)
'''.format(name=merged_user_data.get('name', 'ê³ ê°'))

            prompt = f"""
ë‹¹ì‹ ì€ SKAXì˜ ì‹œë‹ˆì–´ ì»¤ë¦¬ì–´ ë©˜í† ì…ë‹ˆë‹¤. ë™ë£Œ êµ¬ì„±ì›ì¸ {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì˜ ì»¤ë¦¬ì–´ ì„±ì¥ì„ ìœ„í•œ ì‹¤ë¬´ì ì¸ ì¡°ì–¸ê³¼ êµ¬ì²´ì ì¸ ì•¡ì…˜ í”Œëœì„ ì œê³µí•´ì£¼ì„¸ìš”.

ğŸš¨ **ì¤‘ìš” ì§€ì¹¨ - ë°˜ë“œì‹œ ì¤€ìˆ˜í•´ì£¼ì„¸ìš”:**
1. ì•„ë˜ ì‘ë‹µ í˜•ì‹ì˜ ëª¨ë“  ì„¹ì…˜ì„ **ë¹ ì§ì—†ì´** í¬í•¨í•´ì£¼ì„¸ìš”
2. íŠ¹íˆ "ì‚¬ë‚´ ì„ ë°°ë“¤ì˜ ì„±ê³µ ì‚¬ë¡€"ì™€ "ìµœì‹  ì—…ê³„ ë™í–¥" ì„¹ì…˜ì€ **ì ˆëŒ€ ìƒëµí•˜ì§€ ë§ˆì„¸ìš”**
3. ê° ì„¹ì…˜ì˜ í•˜ìœ„ í•­ëª©ë“¤ì„ **ì™„ì „íˆ ì‘ì„±**í•´ì£¼ì„¸ìš”
4. ë‹µë³€ì€ ìƒì„¸í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš” (ê¸¸ì´ ì œí•œ ì—†ìŒ)
5. í† í° ì œí•œìœ¼ë¡œ ì¸í•´ ë‹µë³€ì´ ì¤‘ê°„ì— ëŠì–´ì§€ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì£¼ì„¸ìš”
6. **ìµœì‹  ì—…ê³„ ë™í–¥ ë° íŠ¸ë Œë“œ ì„¹ì…˜ì€ ë°˜ë“œì‹œ ì‹¤ì œ ë‰´ìŠ¤ ë°ì´í„°(ì•„ë˜ news_data)ë§Œì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•˜ê³ , news_dataì˜ ì‹¤ì œ ë‰´ìŠ¤ ê¸°ì‚¬ ë‚´ìš©ì„ ì°¸ê³ í•´ì„œ êµ¬ì²´ì ìœ¼ë¡œ ë‹µë³€í•˜ì„¸ìš”.**

{company_vision_context}

**ìƒë‹´ ëŒ€ìƒì ì •ë³´:**
- ì´ë¦„: {merged_user_data.get('name', 'ê³ ê°')}ë‹˜
- í˜„ì¬ ê²½ë ¥: {merged_user_data.get('experience', 'ì •ë³´ ì—†ìŒ')}
- ë³´ìœ  ìŠ¤í‚¬: {merged_user_data.get('skills', 'ì •ë³´ ì—†ìŒ')}
- ë‹´ë‹¹ ë„ë©”ì¸: {merged_user_data.get('domain', 'ì •ë³´ ì—†ìŒ')}
- í¬ë§ ì„±ì¥ ë°©í–¥: {path_name}
- ê³ ë¯¼ê³¼ ëª©í‘œ: {user_goals[:200]}

{selection_context_str}

**ì‚¬ë‚´ ë™ë£Œë“¤ì˜ ì„±ì¥ ì‚¬ë¡€:**
{career_context}

{data_case_guideline}

**ìµœì‹  ì—…ê³„ ë™í–¥ ë° ê¸°ìˆ  íŠ¸ë Œë“œ:**
{news_context}

**ë°ì´í„° ê¸°ë°˜ ì„±ì¥ ì‚¬ë¡€ ë¶„ì„ ì„¹ì…˜ ì‘ì„± ì§€ì¹¨(ë¬´ì¡°ê±´ ì¤€ìˆ˜):**
- ë°˜ë“œì‹œ ì‹¤ì œ ì‚¬ë‚´ êµ¬ì„±ì› ë°ì´í„°(ê²½ë ¥, ìŠ¤í‚¬, ì„±ì¥ ê³¼ì • ë“±)ë§Œì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
- "ì´ êµ¬ì„±ì›ì€ {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ê³¼ ìœ ì‚¬í•œ ë°°ê²½ì—ì„œ ì‹œì‘í•˜ì—¬, ì´ˆê¸°ì—ëŠ” ì˜¨ë¼ì¸ ê°•ì˜ì™€ ì‚¬ë‚´ í”„ë¡œì íŠ¸ì— ì ê·¹ ì°¸ì—¬í•˜ê³  ì‹¤ë¬´ê²½í—˜ì„ ìŒ“ì•˜ë‹¤"ì™€ ê°™ì´ ìœ ì‚¬í•œ ë°°ê²½ì—ì„œ ì‹œì‘í–ˆë‹¤ëŠ” ëŠë‚Œì„ ê°•ì¡°í•˜ì„¸ìš”.
- ì‹¤ì œ ë°ì´í„°ì— ì—†ëŠ” ì •ë³´(ì˜ˆ: ì´ì§, ì™¸ë¶€ ëŒ€ê¸°ì—… ê²½ë ¥, ì™¸ë¶€ AIíŒ€ ê·¼ë¬´ ë“±)ëŠ” ì ˆëŒ€ ì–¸ê¸‰í•˜ì§€ ë§ˆì„¸ìš”.
- ì„±ì¥ ìŠ¤í† ë¦¬, ê²½ë ¥ íŒ¨í„´ ë“±ë„ ì‹¤ì œ ì‚¬ë‚´ ë°ì´í„°(ê²½ë ¥, ìŠ¤í‚¬, í”„ë¡œì íŠ¸, ì‚¬ë‚´ í™œë™ ë“±)ë§Œì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
- ì—†ëŠ” ì •ë³´, ì¶”ì •/ê°€ê³µëœ ì™¸ë¶€ ê²½ë ¥, í—ˆêµ¬ì˜ ì´ì§/ì™¸ë¶€ í™œë™ ë“±ì€ ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
- ì„±ê³µ ì‚¬ë¡€ëŠ” ì‹¤ì œ ë°ì´í„°ê°€ ìˆëŠ” ë§Œí¼ë§Œ ì‘ì„±í•˜ì„¸ìš”. (ì˜ˆ: 1ëª…ë§Œ ìˆìœ¼ë©´ 1ëª…, 2ëª…ì´ë©´ 2ëª…, ìµœëŒ€ 3ëª…ê¹Œì§€)

** í•µì‹¬ ìš”êµ¬ì‚¬í•­**: ìœ„ì— ì œê³µëœ ì‚¬ìš©ì ë‹µë³€ì„ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ **{merged_user_data.get('name', 'ê³ ê°')}ë‹˜**ì˜ êµ¬ì²´ì ì¸ ìƒí™©, ê³ ë¯¼, ëª©í‘œì— ì§ì ‘ì ìœ¼ë¡œ ë„ì›€ì´ ë˜ëŠ” ì¡°ì–¸ì„ ìš°ì„ ì ìœ¼ë¡œ ì œê³µí•´ì£¼ì„¸ìš”.

** ê°œì¸í™” ì „ëµ**: ì‚¬ìš©ì ë‹µë³€ì—ì„œ ë“œëŸ¬ë‚œ ê°œì¸ì  ìƒí™©, ê³ ë¯¼, ê¸°ëŒ€ì‚¬í•­ì„ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ì¼ë°˜ì ì¸ ì¡°ì–¸ì´ ì•„ë‹Œ **{merged_user_data.get('name', 'ê³ ê°')}ë‹˜**ë§Œì„ ìœ„í•œ ë§ì¶¤í˜• ì•¡ì…˜ í”Œëœì„ ì œì‹œí•´ì£¼ì„¸ìš”.

** í•„ìˆ˜ ì¤€ìˆ˜ì‚¬í•­:**
1. ì•„ë˜ ì‘ë‹µ í˜•ì‹ì„ **ì •í™•íˆ** ë”°ë¼ ì£¼ì„¸ìš”
2. ëª¨ë“  ì„¹ì…˜ì„ **ë¹ ì§ì—†ì´** í¬í•¨í•´ì£¼ì„¸ìš”
3. íŠ¹íˆ "ì‚¬ë‚´ ì„ ë°°ë“¤ì˜ ì„±ê³µ ì‚¬ë¡€"ì™€ "ìµœì‹  ì—…ê³„ ë™í–¥" ì„¹ì…˜ì€ **ë°˜ë“œì‹œ í¬í•¨**í•´ì•¼ í•©ë‹ˆë‹¤
4. ê° ì„¹ì…˜ ì œëª©ê³¼ í•˜ìœ„ í•­ëª©ë“¤ì„ **ì™„ì „íˆ ì‘ì„±**í•´ì£¼ì„¸ìš”
5. ë‹µë³€ì€ ìƒì„¸í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš” (ê¸¸ì´ ì œí•œ ì—†ìŒ)

**ë©˜í† ë§ ì‘ë‹µ í˜•ì‹:**

## {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì„ ìœ„í•œ ì„±ì¥ ë¡œë“œë§µ

ì•ˆë…•í•˜ì„¸ìš”! {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì˜ **{path_name}** ë°©í–¥ ì„±ì¥ì„ í•¨ê»˜ ê³„íší•´ë³´ê² ìŠµë‹ˆë‹¤.

### {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì˜ ìƒí™© ë° ëª©í‘œ ë¶„ì„

**ì‚¬ìš©ì ë‹µë³€ ì „ì²´ ì»¨í…ìŠ¤íŠ¸:**
"{combined_context}"

** AI ë¶„ì„ ê²°ê³¼:**
ìœ„ ë‹µë³€ì„ ì¢…í•© ë¶„ì„í•˜ì—¬ {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì˜ í•µì‹¬ ìƒí™©ê³¼ ëª©í‘œë¥¼ íŒŒì•…í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹¤ë¬´ì ì´ê³  êµ¬ì²´ì ì¸ ì„±ì¥ ì „ëµì„ ì œì‹œí•˜ê² ìŠµë‹ˆë‹¤.

### ì‚¬ë‚´ ì„ ë°°ë“¤ì˜ ì„±ê³µ ì‚¬ë¡€ (ë¬´ì¡°ê±´ í¬í•¨)

**{path_name} ë¡œë“œë§µ ê´€ë ¨ ë™ë£Œë“¤ì˜ ì‹¤ì œ ì„±ì¥ ìŠ¤í† ë¦¬:**

**ë°ì´í„° ê¸°ë°˜ ì„±ì¥ ì‚¬ë¡€ ë¶„ì„:** (ë¬´ì¡°ê±´ í¬í•¨)
{f"- **{merged_user_data.get('name', 'ê³ ê°')}ë‹˜**ê³¼ ìœ ì‚¬í•œ ë°°ê²½ì„ ê°€ì§„ ì‚¬ë‚´ ì„ ë°° {min(len(career_data), 3)}ëª…ì˜ ì‹¤ì œ ë°ì´í„°ë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤" if career_data else "- ìœ ì‚¬í•œ ê²½í—˜ì„ ê°€ì§„ ë™ë£Œë“¤ì˜ ì‹¤ì œ ë°ì´í„°ë¥¼ ë¶„ì„í•´ë³´ë©´"}
- êµ¬ì„±ì›A: [ì‹¤ì œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ êµ¬ì²´ì ì¸ ì„±ì¥ ìŠ¤í† ë¦¬ì™€ í˜„ì¬ ê²½ë¡œ ì„ íƒ ë°°ê²½] (ì‹¤ì œ ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ ì‘ì„±)
- êµ¬ì„±ì›B: [ì‹¤ì œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ êµ¬ì²´ì ì¸ ì„±ì¥ ìŠ¤í† ë¦¬ì™€ í˜„ì¬ ê²½ë¡œ ì„ íƒ ë°°ê²½] (2ëª… ì´ìƒì¼ ë•Œë§Œ ì‘ì„±)
- êµ¬ì„±ì›C: [ì‹¤ì œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ êµ¬ì²´ì ì¸ ì„±ì¥ ìŠ¤í† ë¦¬ì™€ í˜„ì¬ ê²½ë¡œ ì„ íƒ ë°°ê²½] (3ëª… ì´ìƒì¼ ë•Œë§Œ ì‘ì„±)

** ì¤‘ìš”: ì´ "ì‚¬ë‚´ ì„ ë°°ë“¤ì˜ ì„±ê³µ ì‚¬ë¡€" ì„¹ì…˜ì€ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤. ìƒëµí•˜ì§€ ë§ˆì„¸ìš”!**

### ìµœì‹  ì—…ê³„ ë™í–¥ ë° ì‹œì¥ íŠ¸ë Œë“œ (ë¬´ì¡°ê±´ í¬í•¨)

**{path_name} ê´€ë ¨ ìµœì‹  ì—…ê³„ ë™í–¥:** (ë¬´ì¡°ê±´ í¬í•¨)
{f"- **{len(news_data)}ê°œì˜ ìµœì‹  ë‰´ìŠ¤**ë¥¼ ë¶„ì„í•˜ì—¬ {path_name} ë¶„ì•¼ì˜ ì‹œì¥ ë™í–¥ê³¼ ê¸°ìˆ  ë°œì „ ë°©í–¥ì„ íŒŒì•…í–ˆìŠµë‹ˆë‹¤" if news_data else "- ìµœì‹  ì—…ê³„ ë™í–¥ ë° ê¸°ìˆ  íŠ¸ë Œë“œ ë¶„ì„ ê²°ê³¼"}
- **ì‹œì¥ ì „ë§**: [ì‹¤ì œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ë‰´ìŠ¤ ë°ì´í„° ê¸°ë°˜ {path_name} ë¶„ì•¼ì˜ ì„±ì¥ ì „ë§ê³¼ ê¸°íšŒ ìš”ì¸]
- **ê¸°ìˆ  íŠ¸ë Œë“œ**: [ì‹¤ì œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ìµœì‹  ë‰´ìŠ¤ì—ì„œ í™•ì¸ëœ í•µì‹¬ ê¸°ìˆ  ë°œì „ ë°©í–¥ê³¼ **{merged_user_data.get('name', 'ê³ ê°')}ë‹˜**ì˜ ì„±ì¥ ê¸°íšŒ]
- **ì—…ê³„ ë³€í™”**: [ì‹¤ì œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ì‹œì¥ ë³€í™”ì— ë”°ë¥¸ ìƒˆë¡œìš´ ì—­í• ê³¼ ìŠ¤í‚¬ ìš”êµ¬ì‚¬í•­]
- **ì„±ì¥ ê¸°íšŒ**: [ì‹¤ì œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ë‰´ìŠ¤ ë¶„ì„ ê²°ê³¼ ë„ì¶œëœ **{merged_user_data.get('name', 'ê³ ê°')}ë‹˜**ì„ ìœ„í•œ êµ¬ì²´ì  ì„±ì¥ ê¸°íšŒ]

** ì¤‘ìš”: ì´ "ìµœì‹  ì—…ê³„ ë™í–¥" ì„¹ì…˜ë„ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤. ìƒëµí•˜ì§€ ë§ˆì„¸ìš”!**

**{merged_user_data.get('name', 'ê³ ê°')}ë‹˜ê³¼ì˜ ë°ì´í„° ì¼ì¹˜ì :** (ë¬´ì¡°ê±´ í¬í•¨)
- **ê²½ë ¥ ìˆ˜ì¤€**: [ê³ ê°ì˜ í˜„ì¬ ê²½ë ¥ê³¼ ì¼ì¹˜í•˜ëŠ” ì„ ë°°ë“¤ì˜ ë‹¹ì‹œ ìƒí™©]
- **ê¸°ìˆ  ìŠ¤íƒ**: [ê³ ê°ì˜ ë³´ìœ  ê¸°ìˆ ê³¼ ìœ ì‚¬í•œ ì„ ë°°ë“¤ì˜ ì‹œì‘ì ]
- **ë„ë©”ì¸ ê²½í—˜**: [ê³ ê°ì˜ ë„ë©”ì¸ê³¼ ê²¹ì¹˜ëŠ” ì„ ë°°ë“¤ì˜ ì„±ì¥ ë°°ê²½]
- **ì„±ì¥ ë™ê¸°**: [ê³ ê°ì˜ ëª©í‘œì™€ ì¼ì¹˜í•˜ëŠ” ì„ ë°°ë“¤ì˜ ë‹¹ì‹œ ëª©í‘œ]

**ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì„±ì¥ íŒ¨í„´:** (ë¬´ì¡°ê±´ í¬í•¨)
- **í•µì‹¬ ì„±ê³µ ìš”ì¸**: [ì‹¤ì œ ë°ì´í„°ì—ì„œ ë°œê²¬ë˜ëŠ” ê³µí†µì ì¸ ì„±ì¥ ì „ëµ]
- **ë‹¨ê³„ë³„ ì„±ì¥ ê³¼ì •**: [ë°ì´í„°ë¡œ ê²€ì¦ëœ 1ë…„ì°¨â†’3ë…„ì°¨â†’5ë…„ì°¨ ì„±ì¥ ê²½ë¡œ]
- **ì„±ê³µ ì§€í‘œ**: [ì„ ë°°ë“¤ì´ ì‹¤ì œë¡œ ë‹¬ì„±í•œ êµ¬ì²´ì ì¸ ì„±ê³¼ ì§€í‘œ]

**{merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì„ ìœ„í•œ ë§ì¶¤í˜• ë²¤ì¹˜ë§ˆí‚¹:** (ë¬´ì¡°ê±´ í¬í•¨)
- **ë‹µë³€ ì¢…í•© ë¶„ì„**: ì‚¬ìš©ì ë‹µë³€ ì „ì²´ë¥¼ ë¶„ì„í•˜ì—¬ íŒŒì•…í•œ í•µì‹¬ ë‹ˆì¦ˆë¥¼ ë°”íƒ•ìœ¼ë¡œ, ìœ ì‚¬í•œ ê³ ë¯¼ì„ ê°€ì¡Œë˜ ì„ ë°°ë“¤ì˜ êµ¬ì²´ì ì¸ í•´ê²° ê³¼ì •ê³¼ ì„±ê³µ ì „ëµ
- **ê°œì¸ ë§ì¶¤ ì „ëµ**: {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì˜ í˜„ì¬ ìƒí™©({merged_user_data.get('experience', 'ì •ë³´ ì—†ìŒ')} ê²½ë ¥, {', '.join(merged_user_data.get('skills', ['ì •ë³´ ì—†ìŒ'])[:3])} ìŠ¤í‚¬)ê³¼ ë‹µë³€ì—ì„œ ë“œëŸ¬ë‚œ ëª©í‘œë¥¼ ê³ ë ¤í•œ ìµœì  ì„±ì¥ ë¡œë“œë§µ
- **íŠ¸ë Œë“œ ê¸°ë°˜ ê¸°íšŒ**: ìµœì‹  ë‰´ìŠ¤ ë¶„ì„ ê²°ê³¼ íŒŒì•…ëœ {path_name} ë¶„ì•¼ì˜ ì„±ì¥ ê¸°íšŒì™€ **{merged_user_data.get('name', 'ê³ ê°')}ë‹˜**ì˜ ê²½ë ¥ì„ ì—°ê³„í•œ ì „ëµì  í¬ì§€ì…”ë‹
- **ì‹¤í–‰ ê°€ëŠ¥í•œ ì•¡ì…˜**: ë‹µë³€ ë¶„ì„ ê²°ê³¼ì™€ ìµœì‹  íŠ¸ë Œë“œë¥¼ ë°˜ì˜í•˜ì—¬ ë‹¤ìŒ 3ê°œì›” ë‚´ ì¦‰ì‹œ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ì‹¤ë¬´ì  ì¡°ì¹˜ë“¤
- **ì˜ˆìƒ ì„±ê³¼ ë° íƒ€ì„ë¼ì¸**: ë‹µë³€ì—ì„œ ë“œëŸ¬ë‚œ ê°œì¸ì  ëª©í‘œì™€ ì‹œì¥ ì „ë§ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ë‹¨ê³„ë³„ ë§ˆì¼ìŠ¤í†¤ê³¼ ì˜ˆìƒ ê¸°ê°„

*ğŸŒŸ ì´ ì¶”ì²œ ë°©í–¥ì„±ì€ ê°œì¸ì˜ ê²½í—˜ ë°ì´í„°ì™€ í•¨ê»˜ SKAXì˜ ìµœì‹  ê¸°ìˆ  íŠ¸ë Œë“œ ë° ë¹„ì „ ë°©í–¥ì„±ì„ ì¢…í•© ë¶„ì„í•˜ì—¬ ì œì‹œë©ë‹ˆë‹¤.*

### ì¶”ì²œ ë©˜í† /ì„ ë°° (ë¬´ì¡°ê±´ í¬í•¨)

**ì‹¤ì œ êµ¬ì„±ì› ë°ì´í„° ê¸°ë°˜ ë©˜í†  ì¶”ì²œ:** 

**ë©˜í†  A (ì¶”ì²œë„: â˜…â˜…â˜…â˜…â˜…)**
- **ë°°ê²½**: [**{merged_user_data.get('name', 'ê³ ê°')}ë‹˜**ê³¼ ìœ ì‚¬í•œ ê²½ë ¥/ê¸°ìˆ  ìŠ¤íƒì„ ê°€ì§„ ì„ ë°°ì˜ êµ¬ì²´ì  í”„ë¡œí•„]
- **ì¶”ì²œ ì´ìœ **: ì‚¬ìš©ì ë‹µë³€ì—ì„œ ë“œëŸ¬ë‚œ ê³ ë¯¼ê³¼ ëª©í‘œì— ìœ ì‚¬í•œ ê²½í—˜ì„ ê°€ì§„ ì‹¤ì œ ì„ ë°°
- **ì„±ì¥ ìŠ¤í† ë¦¬**: ìœ ì‚¬í•œ ì¶œë°œì ì—ì„œ í˜„ì¬ ì–´ë–¤ ì„±ê³¼ë¥¼ ë‹¬ì„±í–ˆëŠ”ì§€ êµ¬ì²´ì  ë°ì´í„° ê¸°ë°˜ ìŠ¤í† ë¦¬
- **ë©˜í† ë§ ê°€ëŠ¥ ì˜ì—­**: ì‚¬ìš©ì ë‹µë³€ ë¶„ì„ ê²°ê³¼ íŒŒì•…ëœ êµ¬ì²´ì ì¸ ë‹ˆì¦ˆì™€ ê´€ë ¨ëœ ì‹¤ë¬´ì  ì¡°ì–¸ ê°€ëŠ¥ ë¶„ì•¼

**ë©˜í†  B (ì¶”ì²œë„: â˜…â˜…â˜…â˜…â˜†)**  
- **ë°°ê²½**: [ë‹¤ë¥¸ ê´€ì ì—ì„œ **{path_name}** ê²½ë¡œë¥¼ ì„±ê³µì ìœ¼ë¡œ ê±¸ì–´ì˜¨ ì„ ë°°ì˜ í”„ë¡œí•„]
- **ì¶”ì²œ ì´ìœ **: ì‚¬ìš©ì ë‹µë³€ì—ì„œ ë“œëŸ¬ë‚˜ì§€ ì•Šì€ ì ì¬ì  ë‹ˆì¦ˆë‚˜ ë†“ì¹  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì„ ë³´ì™„í•´ì¤„ ìˆ˜ ìˆëŠ” ë©˜í† 
- **ì„±ì¥ ìŠ¤í† ë¦¬**: í•´ë‹¹ ë©˜í† ì˜ ë…íŠ¹í•œ ì„±ì¥ ìŠ¤í† ë¦¬ì™€ í•µì‹¬ ì¸ì‚¬ì´íŠ¸
- **ë©˜í† ë§ ê°€ëŠ¥ ì˜ì—­**: ë‹µë³€ ë¶„ì„ì„ í†µí•´ íŒŒì•…ëœ ê°œì¸ íŠ¹ì„±ì— ë§ëŠ” íŠ¹ë³„í•œ ì¡°ì–¸ ê°€ëŠ¥ ë¶„ì•¼

### {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ ë§ì¶¤ ì•¡ì…˜ í”Œëœ

### ê°œì¸ ë§ì¶¤ ì•¡ì…˜ í”Œëœ

**1. ì‚¬ìš©ì ë‹µë³€ ê¸°ë°˜ í˜„í™© ë¶„ì„**
- ë‹µë³€ì—ì„œ ë“œëŸ¬ë‚˜ëŠ” **ê²½ë¡œ ì„ íƒ ì´ìœ **ì™€ **ê°œì¸ì  ë™ê¸°**
- ì„ íƒí•œ ê²½ë¡œ(**{path_name}**)ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê´€ì‹¬ ë°°ê²½ê³¼ ê¸°ëŒ€ íš¨ê³¼  
- í˜„ì¬ ìƒí™©ì—ì„œ ë“œëŸ¬ë‚˜ëŠ” **ê³ ë¯¼ í¬ì¸íŠ¸**ì™€ **ì„±ì¥ ì˜ì§€**

**2. ë§ì¶¤í˜• ì „ëµ ìˆ˜ë¦½**
- ë‹µë³€ì—ì„œ íŒŒì•…ëœ **êµ¬ì²´ì  ëª©í‘œ**ë¥¼ ìœ„í•œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì•¡ì…˜ ì•„ì´í…œ
- ê°œì¸ì  ìƒí™©ê³¼ **ì œì•½ ì¡°ê±´**ì„ ê³ ë ¤í•œ í˜„ì‹¤ì  ì„±ì¥ ë¡œë“œë§µ
- ë‹µë³€ì—ì„œ ë“œëŸ¬ë‚œ **ê°œì¸ì  ê¸°ëŒ€ì¹˜**ì™€ **ìš°ì„ ìˆœìœ„**ì— ë¶€í•©í•˜ëŠ” ì„±ì¥ ê²½ë¡œ


 **ì´ ê³„íšì€ {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì˜ ì „ì²´ ë‹µë³€ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…í•© ë¶„ì„í•˜ì—¬ ìˆ˜ë¦½ë˜ì—ˆìœ¼ë©°, ê°œì¸ì  ìƒí™©ê³¼ ëª©í‘œì— ë§ì¶° ì–¸ì œë“  ì¡°ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.**

**ë©˜í† ë§ ì‹ ì²­ ë° ì—°ê²° ë°©ë²•:**
- **ì‚¬ë‚´ ë©˜í† ë§ í”„ë¡œê·¸ë¨**: HRíŒ€ ê³µì‹ ì±„ë„ í†µí•´ ì‹ ì²­ (ì›” 1íšŒ ë§¤ì¹­)
- **ë¹„ê³µì‹ ë©˜í† ë§**: ì‚¬ë‚´ ë©”ì‹ ì €ë‚˜ ì´ë©”ì¼ì„ í†µí•œ ê°œë³„ ì»¨íƒ
- **ê·¸ë£¹ ë©˜í† ë§**: ìœ ì‚¬í•œ ëª©í‘œë¥¼ ê°€ì§„ ë™ë£Œë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ê·¸ë£¹ ì„¸ì…˜ ì°¸ì—¬

---(ì´ ëŒ€ì‹œë¶€ë¶„ ë¬´ì¡°ê±´ í¬í•¨)

**ë‹¤ìŒ ìŠ¤í…: ì²´ê³„ì ì¸ í•™ìŠµ ë¡œë“œë§µ ì„¤ê³„**

**{merged_user_data.get('name', 'ê³ ê°')}ë‹˜**ì˜ ë‹µë³€ ì»¨í…ìŠ¤íŠ¸ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ ìœ„ì—ì„œ ì œì‹œí•œ ì„±ì¥ ì „ëµê³¼ ë©˜í† ë§ ê³„íšì„ ë”ìš± êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ í•™ìŠµ ë¡œë“œë§µìœ¼ë¡œ ë°œì „ì‹œì¼œë³´ì‹œê² ì–´ìš”?
í•™ìŠµ ë¡œë“œë§µì„ ì›í•˜ì‹œë©´ "ë„¤, í•™ìŠµ ë¡œë“œë§µì„ ì„¤ê³„í•´ì£¼ì„¸ìš”"ë¼ê³  ë‹µë³€í•´ì£¼ì„¸ìš”!

---

**ì‘ì„± ì›ì¹™:**
- ë™ë£Œì—ê²Œ ì¡°ì–¸í•˜ëŠ” ë”°ëœ»í•˜ê³  ì‹¤ë¬´ì ì¸ í†¤
- **ì‚¬ìš©ìì˜ ì „ì²´ ë‹µë³€ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„**í•˜ì—¬ ê°œì¸í™”ëœ ì¡°ì–¸ ì œê³µ
- ë‹µë³€ ë¶„ì„ì„ í†µí•´ íŒŒì•…ëœ ê°œì¸ì  ìƒí™©ê³¼ ëª©í‘œì— ì§ì ‘ ëŒ€ì‘í•˜ëŠ” ì‹¤ë¬´ì  í•´ê²°ì±… ì œì‹œ
- ì‹¤ì œ ì‚¬ë‚´ì—ì„œ í™œìš© ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤ì™€ ê¸°íšŒ ì¤‘ì‹¬
- ê°œì¸ì •ë³´ëŠ” ìµëª…í™”í•˜ë˜ ì‹¤ì œ ì‚¬ë¡€ì˜ ì§„ì •ì„± ìœ ì§€
- íšŒì‚¬ ë¹„ì „ ì •ë³´ê°€ ì œê³µëœ ê²½ìš°, í•´ë‹¹ ê°€ì¹˜ì™€ ì „ëµ ë°©í–¥ì— ë¶€í•©í•˜ëŠ” ë©˜í† ë§ê³¼ ì•¡ì…˜ í”Œëœ ì œê³µ
- **ìµœì†Œ 2000ì ì´ìƒ**ìœ¼ë¡œ ìƒì„¸í•˜ê³  êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±
- **ëª¨ë“  ì„¹ì…˜ì„ ë¹ ì§ì—†ì´ í¬í•¨**í•˜ê³  ê° í•­ëª©ì„ ì™„ì „íˆ ì‘ì„±
- íŠ¹íˆ "ì‚¬ë‚´ ì„ ë°°ë“¤ì˜ ì„±ê³µ ì‚¬ë¡€"ì™€ "ìµœì‹  ì—…ê³„ ë™í–¥" ì„¹ì…˜ì€ **ì ˆëŒ€ ìƒëµí•˜ì§€ ë§ ê²ƒ**

ğŸš¨ **ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸ - ì‘ë‹µ ì „ ë°˜ë“œì‹œ í™•ì¸:**
âœ“ "ì‚¬ë‚´ ì„ ë°°ë“¤ì˜ ì„±ê³µ ì‚¬ë¡€" ì„¹ì…˜ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€?
âœ“ "ìµœì‹  ì—…ê³„ ë™í–¥ ë° ì‹œì¥ íŠ¸ë Œë“œ" ì„¹ì…˜ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€?
âœ“ ê° ì„¹ì…˜ì˜ í•˜ìœ„ í•­ëª©ë“¤ì´ ëª¨ë‘ ì‘ì„±ë˜ì–´ ìˆëŠ”ê°€?
âœ“ ë‹µë³€ì´ ìµœì†Œ 2000ì ì´ìƒì¸ê°€?
âœ“ ëª¨ë“  ì„¹ì…˜ì´ ì™„ì „íˆ ì‘ì„±ë˜ì–´ ìˆëŠ”ê°€?

ì´ì œ ì‘ë‹µì„ ì‘ì„±í•´ì£¼ì„¸ìš”:
"""
            
            # --- AI í”„ë¡¬í”„íŠ¸ ì§€ì¹¨ì´ ë‹µë³€ì— í¬í•¨ë˜ì§€ ì•Šë„ë¡ ëª…í™•íˆ ì•ˆë‚´ ---
            prompt += """

---
**ì¤‘ìš”:** ìœ„ì˜ ëª¨ë“  ì§€ì¹¨, ì²´í¬ë¦¬ìŠ¤íŠ¸, (ë¬´ì¡°ê±´ í¬í•¨), (ì´ ëŒ€ì‹œë¶€ë¶„ ë¬´ì¡°ê±´ í¬í•¨), , ğŸš¨ ë“±ì€ AIê°€ ë‹µë³€ì„ ì‘ì„±í•  ë•Œ ì°¸ê³ ë§Œ í•˜ë©°, ì‹¤ì œ ì‘ë‹µ(ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” ë‹µë³€)ì—ëŠ” ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”. ì‹¤ì œ ë‹µë³€ì—ëŠ” ì˜¤ì§ ìš”êµ¬ëœ ë§ˆí¬ë‹¤ìš´ êµ¬ì¡°ì™€ ì‹¤ì§ˆì  ë‚´ìš©ë§Œ í¬í•¨í•˜ì„¸ìš”.
ì•„ë˜ ë©˜í† ë§ ì‘ë‹µì€ 'ì•ˆë…•í•˜ì„¸ìš”' ë“± ì¸ì‚¬ë§ ì—†ì´ ë°”ë¡œ {merged_user_data.get('name', 'ê³ ê°')}ë‹˜ì˜ ìƒí™© ë¶„ì„ ë˜ëŠ” í•µì‹¬ ì œì•ˆìœ¼ë¡œ ì‹œì‘í•˜ì„¸ìš”. ì²« ë¬¸ì¥ì€ ë°˜ë“œì‹œ ë¶„ì„/ì œì•ˆ/ìƒí™© ìš”ì•½ìœ¼ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.

---

"""
            response = await client.chat.completions.create(
                model="gpt-4o",
                messages=[{"role": "user", "content": prompt}],
                max_tokens=6000,
                temperature=0.2
            )
            
            ai_content = response.choices[0].message.content.strip()
            
            return ai_content
            
        except Exception as e:
            print(f"AI ì•¡ì…˜ í”Œëœ ìƒì„± ì¤‘ ì˜¤ë¥˜: {e}")
            return "ì•¡ì…˜ í”Œëœì„ ìƒì„±í•˜ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
    
    async def process_deepening_node(self, state: ChatState) -> Dict[str, Any]:
        """
        ì‚¬ìš©ìì˜ ëª©í‘œì™€ ì´ìœ ë¥¼ ë¶„ì„í•˜ì—¬ ì‹¤í–‰ ì „ëµì„ ì œì‹œí•œë‹¤.
        """
        print(" ê²½ë¡œ ì‹¬í™” ë…¼ì˜ ì‹œì‘...")
        
        # State ì „ë‹¬ íŠ¸ë ˆì´ì‹± í™•ì¸ (ë””ë²„ê¹…)
        print(f" DEBUG - path_deepeningì—ì„œ ë°›ì€ state íŠ¸ë ˆì´ì‹±:")
        print(f" DEBUG - state_trace: {state.get('state_trace', 'None')}")
        print(f" DEBUG - career_positioning_timestamp: {state.get('career_positioning_timestamp', 'None')}")
        print(f" DEBUG - consultation_stage: {state.get('consultation_stage', 'None')}")
        print(f" DEBUG - awaiting_user_input: {state.get('awaiting_user_input', 'None')}")
        
        user_response = state.get("user_question", "")
        selected_path = state.get("selected_career_path", {})
        user_data = self.graph_builder.get_user_info_from_session(state)
        collected_info = state.get("collected_user_info", {})
        merged_user_data = {**user_data, **collected_info}
        
        # path_selection ë‹¨ê³„ì—ì„œì˜ ì‚¬ìš©ì ì„ íƒ ì •ë³´ ì¶”ì¶œ
        path_selection_info = state.get("path_selection_info", {})
        path_selection_context = {
            "selected_path_name": selected_path.get("name", "ì„ íƒëœ ê²½ë¡œ"),
            "selected_path_id": selected_path.get("id", ""),
            "combined_user_context": f"{path_selection_info.get('user_input_for_deepening', '')} {user_response}".strip()  # ì „ì²´ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸
        }
        
        # ë””ë²„ê¹…: ë°ì´í„° í™•ì¸
        print(f" DEBUG - path_deepening user_data from session: {user_data}")
        print(f" DEBUG - path_deepening collected_info: {collected_info}")
        print(f" DEBUG - path_deepening merged_user_data: {merged_user_data}")
        print(f" DEBUG - path_selection_context: {path_selection_context}")
        
        # career_positioningì—ì„œ ê²€ìƒ‰ëœ ì‚¬ë‚´ ê²½ë ¥ ë°ì´í„° í™œìš©
        # path_selectionê³¼ path_deepening ì‚¬ì´ì—ëŠ” ë°ì´í„° ì†ì‹¤ì´ ì—†ì–´ì•¼ í•¨
        
        # ë¨¼ì € stateì˜ ëª¨ë“  career ê´€ë ¨ í‚¤ë“¤ì„ í™•ì¸
        career_related_keys = [key for key in state.keys() if 'career' in key.lower()]
        print(f" DEBUG - stateì˜ career ê´€ë ¨ í‚¤ë“¤: {career_related_keys}")
        
        # ì „ì²´ state í‚¤ í™•ì¸ (ë””ë²„ê¹…ìš©)
        all_state_keys = list(state.keys())
        print(f" DEBUG - ì „ì²´ state í‚¤ ê°œìˆ˜: {len(all_state_keys)}")
        print(f" DEBUG - ëª¨ë“  state í‚¤ë“¤: {all_state_keys}")
        
        # retrieved_career_data í™•ì¸
        existing_career_data = state.get("retrieved_career_data", [])
        print(f" DEBUG - stateì—ì„œ ê°€ì ¸ì˜¨ retrieved_career_data: {len(existing_career_data)}ê°œ")
        print(f" DEBUG - retrieved_career_data íƒ€ì…: {type(existing_career_data)}")
        
        if existing_career_data:
            print(f" DEBUG - ì²« ë²ˆì§¸ ë°ì´í„° ìƒ˜í”Œ: {existing_career_data[0] if existing_career_data else 'None'}")
            print(f" DEBUG - ëª¨ë“  employee_id: {[item.get('employee_id', 'N/A') for item in existing_career_data[:5]]}")
            
            # ë°ì´í„° êµ¬ì¡° ê²€ì¦
            if isinstance(existing_career_data[0], dict):
                sample_keys = list(existing_career_data[0].keys())
                print(f" DEBUG - ë°ì´í„° êµ¬ì¡° ê²€ì¦ OK - ìƒ˜í”Œ í‚¤ë“¤: {sample_keys}")
            else:
                print(f"- WARNING - ë°ì´í„° êµ¬ì¡° ì´ìƒ: ì²« ë²ˆì§¸ í•­ëª©ì´ dictê°€ ì•„ë‹˜ - {type(existing_career_data[0])}")
        else:
            print("- WARNING - retrieved_career_dataê°€ ë¹„ì–´ìˆìŒ!")
        
        # ë‰´ìŠ¤ ê²€ìƒ‰ (ê°„ê²°í•˜ê²Œ ê°œì„ )
        fresh_news_data = []
        try:
            # Agentë¥¼ ì‚¬ìš©í•˜ì—¬ ë‰´ìŠ¤ ê²€ìƒ‰
            search_query = f"{selected_path.get('name', '')} {merged_user_data.get('domain', '')}"
            fresh_news_data = self.news_agent.search_relevant_news(
                query=search_query,
                n_results=10
            )
            print(f" SUCCESS - Agent ê¸°ë°˜ ë‰´ìŠ¤ ê²€ìƒ‰ ì™„ë£Œ: {len(fresh_news_data)}ê°œ")
        except Exception as e:
            print(f"- ERROR - Agent ë‰´ìŠ¤ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
            fresh_news_data = []
        
        # ìµœì¢… retrieved_data êµ¬ì„±
        retrieved_data = {
            "career_data": existing_career_data,
            "news_data": fresh_news_data
        }
        
        print(f" DEBUG - AI í˜¸ì¶œ ì „ ìµœì¢… retrieved_data: career_data={len(existing_career_data)}ê°œ, news_data={len(fresh_news_data)}ê°œ")
        
        # AI ê¸°ë°˜ ì‚¬ë‚´ ë°ì´í„° í™œìš© ì•¡ì…˜ í”Œëœ ìƒì„± (path_selection ì»¨í…ìŠ¤íŠ¸ í¬í•¨)
        ai_response = await self._generate_ai_action_plan(
            merged_user_data, selected_path, user_response, retrieved_data, path_selection_context
        )
        
        # ì‚¬ìš©ì ì‘ë‹µ ì»¨í…ìŠ¤íŠ¸ ì €ì¥ (path_selection ì •ë³´ í¬í•¨)
        consultation_context = {
            "user_goals": user_response,
            "selected_path": selected_path,
            "path_selection_context": path_selection_context,
            "analysis_timestamp": "2025-07-02"
        }
        
        # path_deepening ë‹¨ê³„ ê²°ê³¼ë¥¼ ë³„ë„ stateì— ì €ì¥
        # ì‘ë‹µ êµ¬ì„±
        strategy_response = {
            "message": ai_response,
            "action_plan": {
                "context": consultation_context,
                "data_sources": ["career_data", "news_data", "networking_opportunities"]
            }
        }
        # HTML ë¡œê·¸ ì €ì¥
        save_career_response_to_html("path_deepening", strategy_response, state.get("session_id", "unknown"))

        # path_deepening_infoì— ê²°ê³¼ ì €ì¥ (ë°˜í™˜ ë”•ì…”ë„ˆë¦¬ì—ë„ ëª…ì‹œì ìœ¼ë¡œ í¬í•¨)
        return {
            **state,
            "consultation_stage": "learning_decision",
            "consultation_context": consultation_context,
            "formatted_response": strategy_response,
            "final_response": strategy_response,
            "path_deepening_info": strategy_response,  # ëª…ì‹œì ìœ¼ë¡œ í¬í•¨
            "awaiting_user_input": True,
            "next_expected_input": "learning_roadmap_decision",
            "processing_log": state.get("processing_log", []) + ["ì‹¤í–‰ ì „ëµ ìˆ˜ë¦½ ì™„ë£Œ"]
        }
